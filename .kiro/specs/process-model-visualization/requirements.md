# Requirements Document

## Introduction

This feature enhances the visualization and comparison of Appian Process Models in the merge assistant. Currently, process models display raw XML content which is not human-readable or useful for understanding what needs to be implemented. This enhancement will parse process model XML files to extract structured information about nodes, their properties, and functionality, presenting it in a clear, actionable format for developers.

## Glossary

- **Process Model**: An Appian object that defines a workflow with nodes, flows, and business logic
- **Node**: A step or activity within a process model (e.g., User Input Task, Script Task, Gateway)
- **Node Properties**: Configuration details for a node including name, type, assignments, expressions, and forms
- **Blueprint**: The structured JSON representation of an Appian application generated by the analyzer
- **Merge Assistant**: The three-way merge tool that helps users incorporate vendor changes into customized applications
- **Change Detail Page**: The UI page showing differences between base, customer, and vendor versions of an object
- **SAIL Code**: Appian's expression language used in interfaces and rules
- **AC Element**: Activity Class element in process model XML containing node configuration
- **Form Config**: Configuration specifying which interface is used for a user input task
- **Output Expressions**: Expressions that set process variable values after node execution

## Requirements

### Requirement 1

**User Story:** As a developer reviewing process model changes, I want to see a structured summary of all nodes and their properties, so that I can understand what functionality needs to be implemented.

#### Acceptance Criteria

1. WHEN the system parses a process model XML file THEN the system SHALL extract all node elements from the XML structure
2. WHEN a node is extracted THEN the system SHALL identify the node type (User Input Task, Script Task, Gateway, Subprocess, etc.)
3. WHEN a node is extracted THEN the system SHALL capture the node name from the name element
4. WHEN a node is extracted THEN the system SHALL extract all configuration properties from the AC element
5. WHEN node properties are extracted THEN the system SHALL format them as human-readable key-value pairs

### Requirement 2

**User Story:** As a developer, I want to see which interfaces and rules are used in each process model node, so that I can understand dependencies and implementation requirements.

#### Acceptance Criteria

1. WHEN a User Input Task node is parsed THEN the system SHALL extract the interface UUID from the form-config element
2. WHEN an interface UUID is extracted THEN the system SHALL resolve the UUID to the interface name using the object lookup
3. WHEN a Script Task node is parsed THEN the system SHALL extract all rule references from expressions
4. WHEN rule UUIDs are extracted THEN the system SHALL resolve the UUIDs to rule names using the object lookup
5. WHEN output expressions are parsed THEN the system SHALL extract variable assignments and their values

### Requirement 3

**User Story:** As a developer, I want to see node assignments and escalations, so that I can understand who is responsible for completing tasks.

#### Acceptance Criteria

1. WHEN a node has assignment configuration THEN the system SHALL extract assignee information (users, groups, or expressions)
2. WHEN a node has escalation configuration THEN the system SHALL extract escalation rules and timing
3. WHEN assignment expressions reference groups THEN the system SHALL resolve group UUIDs to group names
4. WHEN assignment is expression-based THEN the system SHALL display the complete assignment expression
5. WHEN a node has no assignment THEN the system SHALL indicate that the node is system-executed

### Requirement 4

**User Story:** As a developer comparing process model versions, I want to see node-by-node differences, so that I can identify what changed between versions.

#### Acceptance Criteria

1. WHEN comparing two process model versions THEN the system SHALL compare nodes by their UUID
2. WHEN a node exists in both versions THEN the system SHALL identify which properties changed
3. WHEN a node is added in the new version THEN the system SHALL mark it as ADDED with all properties
4. WHEN a node is removed in the new version THEN the system SHALL mark it as REMOVED with all properties
5. WHEN node properties differ THEN the system SHALL show before and after values for each changed property

### Requirement 5

**User Story:** As a developer, I want to see process flows and conditions, so that I can understand the workflow logic and visualize how nodes are connected.

#### Acceptance Criteria

1. WHEN the system parses a process model THEN the system SHALL extract all flow elements with source and target node information
2. WHEN a flow is extracted THEN the system SHALL identify the source node UUID and target node UUID
3. WHEN a flow has a condition THEN the system SHALL extract and display the condition expression
4. WHEN flows are displayed THEN the system SHALL show them as connections between named nodes with directional indicators
5. WHEN a flow is unconditional THEN the system SHALL indicate it as a default flow
6. WHEN the system extracts flows THEN the system SHALL build a complete flow graph showing all node connections
7. WHEN displaying the flow graph THEN the system SHALL identify start nodes, end nodes, and intermediate nodes
8. WHEN comparing process model versions THEN the system SHALL identify which flows were added, removed, or modified

### Requirement 6

**User Story:** As a developer, I want to see process variables and their usage, so that I can understand data flow through the process.

#### Acceptance Criteria

1. WHEN the system parses a process model THEN the system SHALL extract all process variable definitions
2. WHEN a variable is extracted THEN the system SHALL capture its name, type, and parameter status
3. WHEN a variable is used in node expressions THEN the system SHALL identify which nodes reference it
4. WHEN output expressions set variables THEN the system SHALL show which nodes modify which variables
5. WHEN a variable is a parameter THEN the system SHALL indicate it is an input to the process

### Requirement 7

**User Story:** As a developer viewing the change detail page, I want process model information displayed in a readable format with visual flow representation, so that I can quickly understand what needs to be implemented and track where changes occurred.

#### Acceptance Criteria

1. WHEN the change detail page displays a process model THEN the system SHALL show a structured node summary instead of raw XML
2. WHEN displaying node information THEN the system SHALL group properties by category (Basic Info, Assignment, Forms, Expressions, Escalation)
3. WHEN displaying three-way comparison THEN the system SHALL show node summaries for base, customer, and vendor versions side-by-side
4. WHEN a node property changed THEN the system SHALL highlight the changed property in the comparison view
5. WHEN displaying process flows THEN the system SHALL show a visual flow diagram with nodes and connections
6. WHEN displaying the flow diagram THEN the system SHALL use different visual indicators for different node types (tasks, gateways, subprocesses)
7. WHEN comparing flow diagrams THEN the system SHALL highlight added nodes, removed nodes, and modified nodes with distinct colors
8. WHEN a user clicks on a node in the flow diagram THEN the system SHALL show detailed node properties
9. WHEN displaying flows THEN the system SHALL show flow conditions on the connection lines
10. WHEN the flow is complex THEN the system SHALL provide zoom and pan capabilities for the visual diagram

### Requirement 8

**User Story:** As a developer, I want the process model parser to handle all node types, so that I get complete information regardless of process complexity.

#### Acceptance Criteria

1. WHEN the system encounters a User Input Task THEN the system SHALL extract form configuration and assignment details
2. WHEN the system encounters a Script Task THEN the system SHALL extract expressions and output mappings
3. WHEN the system encounters a Gateway THEN the system SHALL extract branching conditions
4. WHEN the system encounters a Subprocess node THEN the system SHALL extract the subprocess reference and parameter mappings
5. WHEN the system encounters an unknown node type THEN the system SHALL extract all available properties without failing

### Requirement 9

**User Story:** As a developer, I want the enhanced process model parsing to work seamlessly with existing functionality, so that no current features are broken.

#### Acceptance Criteria

1. WHEN the enhanced parser is implemented THEN the system SHALL maintain backward compatibility with existing blueprint structure
2. WHEN generating blueprints THEN the system SHALL include both the new structured node data and existing business_logic field
3. WHEN comparing process models THEN the system SHALL use the enhanced node data for detailed comparisons
4. WHEN displaying non-process-model objects THEN the system SHALL continue using existing display logic
5. WHEN the enhanced parser fails THEN the system SHALL fall back to displaying raw XML without breaking the application

### Requirement 10

**User Story:** As a developer, I want process model parsing to extract SAIL expressions and format them, so that I can read the business logic clearly.

#### Acceptance Criteria

1. WHEN a node contains SAIL expressions THEN the system SHALL extract and format them using the SAIL formatter
2. WHEN expressions reference other objects THEN the system SHALL resolve UUIDs to object names
3. WHEN expressions are complex THEN the system SHALL preserve the expression structure for readability
4. WHEN output expressions assign values THEN the system SHALL show the variable name and the expression that computes its value
5. WHEN expressions contain Appian functions THEN the system SHALL convert internal function names to public API names
